<body class="login-body">
    <div id="view-login" style="display: flex;"> <div class="v-login-box">
            <div class="login-header">
                <i data-lucide="zap" class="login-icon"></i>
                <h1>Bon retour parmi nous</h1>
            </div>

            <div id="error-msg" class="error-msg"></div>

            <div class="form-group">
                <label>Email professionnel</label>
                <input type="email" id="user-email" placeholder="nom@entreprise.com">
            </div>

            <div class="form-group">
                <label>Mot de passe</label>
                <input type="password" id="user-pass" placeholder="••••••••">
            </div>

            <button class="v-btn-auth" id="btn-login" onclick="checkAuth()">
                <span id="btn-text">Continuer</span>
            </button>

            <div class="social-divider">ou</div>

            <button class="social-btn">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18" style="margin-right: 10px; vertical-align: middle;">
                Continuer avec Google
            </button>
            
            <p class="back-link">Pas de compte ? <a href="#" style="color: var(--sp-green); text-decoration: none;">S'inscrire</a></p>
        </div>
    </div>

    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Initialisation Lucide
        lucide.createIcons();

        // 1. CONFIGURATION SUPABASE
        const SB_URL = 'https://rayyxgqgiwjytesoykgd.supabase.co';
        const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJheXl4Z3FnaXdqeXRlc295a2dkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4MjgxMTQsImV4cCI6MjA4NjQwNDExNH0.KTGP8Kj9ueLBzasriq4sHJyNDK6nSryvZjc6NCsWRSM'; 
        const oxClient = supabase.createClient(SB_URL, SB_KEY);

        // 2. LOGIQUE DE CONNEXION AVEC EFFET DE CHARGEMENT
        async function checkAuth() {
            const email = document.getElementById('user-email').value.trim();
            const pass = document.getElementById('user-pass').value.trim();
            const errorDiv = document.getElementById('error-msg');
            const btn = document.getElementById('btn-login');
            const btnText = document.getElementById('btn-text');

            errorDiv.style.display = 'none';

            if (!email || !pass) {
                showError("Veuillez remplir tous les champs.");
                return;
            }

            // Animation de chargement
            btn.style.opacity = "0.7";
            btn.style.cursor = "wait";
            btnText.innerText = "Vérification...";

            try {
                const { data, error } = await oxClient.auth.signInWithPassword({
                    email: email,
                    password: pass
                });

                if (error) throw error;

                // Redirection
                window.location.href = 'app.html';

            } catch (err) {
                showError("Identifiants incorrects ou compte inexistant.");
                btn.style.opacity = "1";
                btn.style.cursor = "pointer";
                btnText.innerText = "Continuer";
            }
        }

        function showError(msg) {
            const errorDiv = document.getElementById('error-msg');
            errorDiv.innerText = msg;
            errorDiv.style.display = 'block';
        }

        // Vérification automatique de session
        async function checkSession() {
            const { data } = await oxClient.auth.getSession();
            if (data?.session) window.location.href = 'app.html';
        }
        checkSession();
    </script>
</body>
