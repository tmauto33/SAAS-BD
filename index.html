<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OX PRO - Expert en Rentabilité</title>
    <link rel="stylesheet" href="vitrine.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <header class="v-header">
        <div class="v-logo"><i data-lucide="zap"></i> OX PRO</div>
        <button class="v-btn-login" onclick="showLogin()">Connexion</button>
    </header>

    <main class="v-container" id="view-paywall">
        <h1>Votre rentabilité sans limites.</h1>
        
        <div class="payment-methods">
            <img src="https://upload.wikimedia.org/wikipedia/commons/5/5e/Visa_Inc._logo.svg" alt="Visa">
            <img src="https://upload.wikimedia.org/wikipedia/commons/2/2a/Mastercard-logo.svg" alt="Mastercard">
            <img src="https://upload.wikimedia.org/wikipedia/commons/b/b5/PayPal.svg" alt="PayPal">
        </div>

        <p class="subtitle">Accédez à l'expertise IA et l'historique illimité.</p>

        <div class="v-grid">
            <div class="v-card">
                <span class="v-badge">0€ pour 1 mois</span>
                <h2>Essai Découverte</h2>
                <span class="price-sub">Gratuit pendant 7 jours</span>
                <hr>
                <ul>
                    <li><i data-lucide="check"></i> 1er dossier complet offert</li>
                    <li><i data-lucide="check"></i> Rapport PDF exportable</li>
                    <li><i data-lucide="check"></i> Accès IA standard</li>
                </ul>
                <button onclick="showLogin()">Essayer gratuitement</button>
            </div>

            <div class="v-card pro">
                <span class="v-badge pro">Professionnel</span>
                <h2>Pack OX PRO</h2>
                <span class="price-sub">29€ / mois sans engagement</span>
                <hr>
                <ul>
                    <li><i data-lucide="check"></i> Historique illimité</li>
                    <li><i data-lucide="check"></i> Expertise IA avancée</li>
                    <li><i data-lucide="check"></i> Support prioritaire 24/7</li>
                    <li><i data-lucide="check"></i> Analyses prédictives</li>
                </ul>
                <button onclick="showLogin()">S'abonner maintenant</button>
            </div>
        </div>
    </main>

    <div class="v-container" id="view-login" style="display:none;">
        <div class="v-login-box">
            <i data-lucide="zap" class="login-icon"></i>
            <h1>Bon retour parmi nous</h1>
            
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="email" placeholder="votre@email.com">
            </div>

            <div class="form-group">
                <label>Mot de passe</label>
                <input type="password" id="pass" placeholder="******">
            </div>

            <div id="auth-error-msg" style="color: #ff4444; font-size: 0.85rem; margin-bottom: 10px; display: none;"></div>

            <button class="v-btn-auth" id="btn-login" onclick="handleAuth('LOGIN')">Se connecter</button>
            <button class="v-btn-auth" id="btn-signup" onclick="handleAuth('SIGNUP')" style="background: transparent; border: 1px solid #ffcc00; margin-top: 10px;">Créer un compte</button>

            <div class="social-divider">ou</div>
            
            <button class="social-btn">Continuer avec Google</button>

            <p onclick="showPaywall()" style="cursor:pointer; margin-top:25px; color:#b3b3b3; font-size:0.9rem;">
                ← Retour aux tarifs
            </p>
        </div>
    </div>

    <script>
    // 1. INITIALISATION - On utilise 'supabaseClient' pour éviter le conflit
    const SUPABASE_URL = 'https://rayyxgqgiwjytesoykgd.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJheXl4Z3FnaXdqeXRlc295a2dkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4MjgxMTQsImV4cCI6MjA4NjQwNDExNH0.KTGP8Kj9ueLBzasriq4sHJyNDK6nSryvZjc6NCsWRSM'; // <-- Assure-toi que c'est bien la clé anon
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // Initialisation des icônes
    lucide.createIcons();
    
    // 2. NAVIGATION
    function showLogin() {
        document.getElementById('view-paywall').style.display = 'none';
        document.getElementById('view-login').style.display = 'flex';
    }
    function showPaywall() {
        document.getElementById('view-login').style.display = 'none';
        document.getElementById('view-paywall').style.display = 'block';
    }

    // 3. AUTHENTIFICATION
   async function handleAuth(mode) {
    // 1. Récupération propre des valeurs
    const emailInput = document.getElementById('email');
    const passInput = document.getElementById('pass');
    const errorDiv = document.getElementById('auth-error-msg');

    const email = emailInput.value.trim();
    const password = passInput.value.trim();

    errorDiv.style.display = 'none';

    // 2. Vérification locale avant d'appeler Supabase
    if (!email || !password) {
        errorDiv.innerText = "L'email et le mot de passe sont obligatoires.";
        errorDiv.style.display = 'block';
        return;
    }

    if (password.length < 6) {
        errorDiv.innerText = "Le mot de passe doit faire au moins 6 caractères.";
        errorDiv.style.display = 'block';
        return;
    }

    // 3. Appel à Supabase
    if (mode === 'SIGNUP') {
        const { data, error } = await supabaseClient.auth.signUp({
            email: email,
            password: password
        });

        if (error) {
            errorDiv.innerText = "Erreur d'inscription : " + error.message;
            errorDiv.style.display = 'block';
        } else {
            // Si l'inscription réussit mais qu'une confirmation mail est requise
            if (data.user && data.session === null) {
                alert("Compte créé ! Vérifie tes emails pour confirmer ton adresse avant de te connecter.");
            } else {
                alert("Inscription réussie !");
                window.location.href = 'app.html';
            }
        }
    } else {
        const { data, error } = await supabaseClient.auth.signInWithPassword({
            email: email,
            password: password
        });

    
</body>
</html>





