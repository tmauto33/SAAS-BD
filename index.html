<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OX PRO - Expert en Rentabilité</title>
    <link rel="stylesheet" href="vitrine.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <header class="v-header">
        <div class="v-logo"><i data-lucide="zap"></i> OX PRO</div>
        <button class="v-btn-login" onclick="showLogin()">Connexion</button>
        <button class="v-btn-auth" onclick="window.location.href='signup.html'" style="background: transparent; border: 1px solid #ffcc00; margin-top: 10px;">
    Créer un compte
</button>
    </header>

    <main class="v-container" id="view-paywall">
        <h1>Votre rentabilité sans limites.</h1>
        
        <div class="payment-methods">
            <img src="https://upload.wikimedia.org/wikipedia/commons/5/5e/Visa_Inc._logo.svg" alt="Visa">
            <img src="https://upload.wikimedia.org/wikipedia/commons/2/2a/Mastercard-logo.svg" alt="Mastercard">
            <img src="https://upload.wikimedia.org/wikipedia/commons/b/b5/PayPal.svg" alt="PayPal">
        </div>

        <p class="subtitle">Accédez à l'expertise IA et l'historique illimité.</p>

        <div class="v-grid">
            <div class="v-card">
                <span class="v-badge">0€ pour 1 mois</span>
                <h2>Essai Découverte</h2>
                <span class="price-sub">Gratuit pendant 7 jours</span>
                <hr>
                <ul>
                    <li><i data-lucide="check"></i> 1er dossier complet offert</li>
                    <li><i data-lucide="check"></i> Rapport PDF exportable</li>
                    <li><i data-lucide="check"></i> Accès IA standard</li>
                </ul>
                <button onclick="showLogin()">Essayer gratuitement</button>
            </div>

            <div class="v-card pro">
                <span class="v-badge pro">Professionnel</span>
                <h2>Pack OX PRO</h2>
                <span class="price-sub">29€ / mois sans engagement</span>
                <hr>
                <ul>
                    <li><i data-lucide="check"></i> Historique illimité</li>
                    <li><i data-lucide="check"></i> Expertise IA avancée</li>
                    <li><i data-lucide="check"></i> Support prioritaire 24/7</li>
                    <li><i data-lucide="check"></i> Analyses prédictives</li>
                </ul>
                <button onclick="showLogin()">S'abonner maintenant</button>
            </div>
        </div>
    </main>

    <div class="v-container" id="view-login" style="display:none;">
    <div class="v-login-box">
        <div class="login-header">
            <i data-lucide="zap" class="login-icon"></i>
            <h1>Bienvenue parmi nous</h1>
            <p class="subtitle">Connectez-vous pour piloter votre rentabilité.</p>
        </div>
        
        <div class="form-group">
            <label>Email professionnel</label>
            <input type="email" id="email" placeholder="nom@entreprise.com">
        </div>

        <div class="form-group">
            <label>Mot de passe</label>
            <input type="password" id="pass" placeholder="••••••••">
        </div>

        <div id="auth-error-msg" class="error-msg"></div>

        <button class="v-btn-auth" id="btn-login" onclick="handleAuth('LOGIN')">Se connecter</button>
        
        <button class="v-btn-secondary" onclick="window.location.href='signup.html'">
            Pas encore de compte ? Créer un profil
        </button>

        <div class="social-divider">ou continuer avec</div>
        
        <div class="social-grid">
            <button class="social-btn"><img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18"> Google</button>
        </div>

        <p onclick="showPaywall()" class="back-link">
            ← Retour aux tarifs
        </p>
    </div>
</div>

    <script>
    // 1. CONFIGURATION DIRECTE
    const SB_URL = 'https://rayyxgqgiwjytesoykgd.supabase.co';
    const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJheXl4Z3FnaXdqeXRlc295a2dkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4MjgxMTQsImV4cCI6MjA4NjQwNDExNH0.KTGP8Kj9ueLBzasriq4sHJyNDK6nSryvZjc6NCsWRSM'; 
    
    // Initialisation du client avec un nom unique pour éviter les conflits
    const oxClient = supabase.createClient(SB_URL, SB_KEY);

    // Initialisation des icônes
    lucide.createIcons();
    
    // 2. FONCTIONS DE NAVIGATION (window. pour garantir l'accès)
    window.showLogin = function() {
        document.getElementById('view-paywall').style.display = 'none';
        document.getElementById('view-login').style.display = 'flex';
    };

    window.showPaywall = function() {
        document.getElementById('view-login').style.display = 'none';
        document.getElementById('view-paywall').style.display = 'block';
    };

    // 3. LOGIQUE D'AUTHENTIFICATION
    window.handleAuth = async function(mode) {
        const email = document.getElementById('email').value.trim();
        const pass = document.getElementById('pass').value.trim();
        const errorDiv = document.getElementById('auth-error-msg');

        errorDiv.style.display = 'none';

        if (!email || !pass) {
            errorDiv.innerText = "Email et mot de passe requis.";
            errorDiv.style.display = 'block';
            return;
        }

        try {
            if (mode === 'SIGNUP') {
                const { data, error } = await oxClient.auth.signUp({ 
                    email: email, 
                    password: pass 
                });
                if (error) throw error;
                alert("Inscription réussie ! Vérifie tes emails si la confirmation est activée.");
            } else {
                const { data, error } = await oxClient.auth.signInWithPassword({ 
                    email: email, 
                    password: pass 
                });
                if (error) throw error;
                // Si ça marche, on va sur l'app
                window.location.href = 'app.html';
            }
        } catch (err) {
            console.error("Erreur Auth:", err.message);
            errorDiv.innerText = "Erreur : " + err.message;
            errorDiv.style.display = 'block';
        }
    };

    // 4. VÉRIFICATION DE SESSION AU CHARGEMENT
    async function checkSession() {
        try {
            const { data } = await oxClient.auth.getSession();
            if (data?.session) {
                window.location.href = 'app.html';
            }
        } catch (e) {
            console.log("Pas de session active");
        }
    }
    
    // Lancement de la vérif
    checkSession();
</script>
</body>
</html>








