<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OX PRO - Expert en Rentabilité</title>
    <link rel="stylesheet" href="vitrine.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <header class="v-header">
        <div class="v-logo"><i data-lucide="zap"></i> OX PRO</div>
        <div class="header-auth-group">
            <button class="v-btn-login-outline" onclick="showLogin()">Connexion</button>
            <button class="v-btn-signup-solid" onclick="showSignup()">S'inscrire</button>
        </div>
    </header>

    <main class="v-container" id="view-paywall">
        <h1>Votre rentabilité sans limites.</h1>
        
        <div class="payment-methods">
            <img src="https://upload.wikimedia.org/wikipedia/commons/5/5e/Visa_Inc._logo.svg" alt="Visa">
            <img src="https://upload.wikimedia.org/wikipedia/commons/2/2a/Mastercard-logo.svg" alt="Mastercard">
            <img src="https://upload.wikimedia.org/wikipedia/commons/b/b5/PayPal.svg" alt="PayPal">
        </div>

        <p class="subtitle">Accédez à l'expertise IA et l'historique illimité.</p>

        <div class="v-grid">
            <div class="v-card">
                <span class="v-badge">0€ pour 1 mois</span>
                <h2>Essai Découverte</h2>
                <span class="price-sub">Gratuit pendant 7 jours</span>
                <hr>
                <ul>
                    <li><i data-lucide="check"></i> 1er dossier complet offert</li>
                    <li><i data-lucide="check"></i> Rapport PDF exportable</li>
                    <li><i data-lucide="check"></i> Accès IA standard</li>
                </ul>
                <button onclick="showSignup()">Essayer gratuitement</button>
            </div>

            <div class="v-card pro">
                <span class="v-badge pro">Professionnel</span>
                <h2>Pack OX PRO</h2>
                <span class="price-sub">29€ / mois sans engagement</span>
                <hr>
                <ul>
                    <li><i data-lucide="check"></i> Historique illimité</li>
                    <li><i data-lucide="check"></i> Expertise IA avancée</li>
                    <li><i data-lucide="check"></i> Support prioritaire 24/7</li>
                    <li><i data-lucide="check"></i> Analyses prédictives</li>
                </ul>
                <button onclick="showSignup()">S'abonner maintenant</button>
            </div>
        </div>
    </main>

    <div class="v-container" id="view-login" style="display:none;">
        <div class="v-login-box">
            <div class="login-header">
                <i data-lucide="zap" class="login-icon"></i>
                <h1>Bienvenue parmi nous</h1>
                <p class="subtitle">Connectez-vous pour piloter votre rentabilité.</p>
            </div>
            
            <div class="form-group">
                <label>Email professionnel</label>
                <input type="email" id="login-email" placeholder="nom@entreprise.com">
            </div>

            <div class="form-group">
                <label>Mot de passe</label>
                <input type="password" id="login-pass" placeholder="••••••••">
            </div>

            <div id="login-error-msg" class="error-msg" style="color: #ff4d4d; margin-bottom: 10px; display: none;"></div>

            <button class="v-btn-auth" onclick="handleAuth('LOGIN')">Se connecter</button>
            
            <button class="v-btn-secondary" onclick="showSignup()">
                Pas encore de compte ? Créer un profil
            </button>

            <div class="social-divider">ou continuer avec</div>
            <div class="social-grid">
                <button class="social-btn"><img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18"> Google</button>
            </div>

            <p onclick="showPaywall()" class="back-link" style="cursor:pointer; margin-top:20px; text-align:center; color: #888;">
                ← Retour aux tarifs
            </p>
        </div>
    </div>

    <div class="v-container" id="view-signup" style="display:none;">
        <div class="v-login-box">
            <div class="login-header">
                <i data-lucide="user-plus" class="login-icon"></i>
                <h1>Créer un compte</h1>
                <p class="subtitle">Commencez votre essai gratuit OX PRO.</p>
            </div>
            
            <div class="form-group">
                <label>Email professionnel</label>
                <input type="email" id="signup-email" placeholder="nom@entreprise.com">
            </div>

            <div class="form-group">
                <label>Mot de passe</label>
                <input type="password" id="signup-pass" placeholder="6 caractères minimum">
            </div>

            <div id="signup-error-msg" class="error-msg" style="color: #ff4d4d; margin-bottom: 10px; display: none;"></div>

            <button class="v-btn-auth" onclick="handleAuth('SIGNUP')" style="background: #22c55e;">S'inscrire gratuitement</button>
            
            <button class="v-btn-secondary" onclick="showLogin()">
                Déjà inscrit ? Se connecter
            </button>

            <p onclick="showPaywall()" class="back-link" style="cursor:pointer; margin-top:20px; text-align:center; color: #888;">
                ← Retour aux tarifs
            </p>
        </div>
    </div>

    <script>
    // 1. CONFIGURATION SUPABASE
    const SB_URL = 'https://rayyxgqgiwjytesoykgd.supabase.co';
    const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJheXl4Z3FnaXdqeXRlc295a2dkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4MjgxMTQsImV4cCI6MjA4NjQwNDExNH0.KTGP8Kj9ueLBzasriq4sHJyNDK6nSryvZjc6NCsWRSM'; 
    const oxClient = supabase.createClient(SB_URL, SB_KEY);

    lucide.createIcons();
    
    // 2. NAVIGATION ENTRE LES VUES
    window.showLogin = function() {
        document.getElementById('view-paywall').style.display = 'none';
        document.getElementById('view-signup').style.display = 'none';
        document.getElementById('view-login').style.display = 'flex';
    };

    window.showSignup = function() {
        document.getElementById('view-paywall').style.display = 'none';
        document.getElementById('view-login').style.display = 'none';
        document.getElementById('view-signup').style.display = 'flex';
    };

    window.showPaywall = function() {
        document.getElementById('view-login').style.display = 'none';
        document.getElementById('view-signup').style.display = 'none';
        document.getElementById('view-paywall').style.display = 'block';
    };

    // 3. LOGIQUE D'AUTHENTIFICATION
    window.handleAuth = async function(mode) {
        const prefix = (mode === 'SIGNUP') ? 'signup-' : 'login-';
        const email = document.getElementById(prefix + 'email').value.trim();
        const pass = document.getElementById(prefix + 'pass').value.trim();
        const errorDiv = document.getElementById(prefix + 'error-msg');

        errorDiv.style.display = 'none';

        if (!email || !pass) {
            errorDiv.innerText = "Email et mot de passe requis.";
            errorDiv.style.display = 'block';
            return;
        }

        try {
            if (mode === 'SIGNUP') {
                const { data, error } = await oxClient.auth.signUp({ email, password: pass });
                if (error) throw error;
                alert("Inscription réussie ! Un email de confirmation vous a été envoyé.");
                showLogin();
            } else {
                const { data, error } = await oxClient.auth.signInWithPassword({ email, password: pass });
                if (error) throw error;
                window.location.href = 'app.html';
            }
        } catch (err) {
            errorDiv.innerText = err.message;
            errorDiv.style.display = 'block';
        }
    };

    // 4. VERIFICATION SESSION
    async function checkSession() {
        const { data } = await oxClient.auth.getSession();
        if (data?.session) window.location.href = 'app.html';
    }
    checkSession();
</script>
</body>
</html>
